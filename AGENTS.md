# Repository Guidelines

## Project Structure & Module Organization
- `src/` contains the TypeScript React app; `components/GraphCanvas/` wraps React Flow, `components/NodeCard.tsx` renders individual stages, and `components/ProgressIndicator.tsx` drives the phase overlay.
- `src/lib/` holds shared logic: `layout/elk.ts` computes node positioning, `adapters/mermaidAdapter.ts` parses Mermaid graph files, and `utils/types.ts` centralises shared types.
- `src/styles/global.css` defines CSS variables and defaults consumed by components; keep palette updates here.
- `public/data/graph.mmd` is the live Mermaid graph read at runtime, while static shell markup lives in `index.html`.
- `scripts/gen-tree-progressive.js` progressively writes `graph.mmd`; run it when adjusting narrative phases.

## Build, Test, and Development Commands
- `npm install` installs front-end dependencies; rerun after package updates.
- `npm run dev` launches Vite at `http://localhost:5173` with hot reload.
- `npm run build` produces the optimised bundle in `dist/` for deployment checks.
- `npm run preview` serves the production build on port 5174 for QA.
- `node scripts/gen-tree-progressive.js` regenerates phased graph snapshots in `public/data/`.

## Coding Style & Naming Conventions
- Use strict TypeScript with ES modules; prefer functional React components and hooks over classes.
- Retain two-space indentation and trailing commas as in `GraphCanvas/index.tsx`.
- Name components and hooks in PascalCase (`GraphCanvas`, `useGraphData`), utilities in camelCase, and CSS classes in kebab-case.
- Store reusable colours or spacing tokens in `global.css`; import module-scoped styles only when necessary.

## Testing Guidelines
- Automated tests are not yet configured; prioritise manual verification of layout changes in both dev and preview builds.
- If you introduce tests, prefer Vitest + React Testing Library, co-locating specs under `src/__tests__/` (e.g., `src/__tests__/GraphCanvas.test.tsx`).
- Assert graph node counts to guard regressions when adding tests.

## Commit & Pull Request Guidelines
- Follow the conventional commits style visible in history (`feat:`, `fix:`); keep scope concise and the subject under 60 characters.
- Group related changes per commit, and document breaking updates with a `BREAKING CHANGE` footer when relevant.
- Pull requests should outline intent, testing evidence (manual steps or screenshots of the canvas), and link any tracked issues.
- Call out data changes to `public/data/graph.mmd` so reviewers can rebuild narratives before merging.

## Graph Data Workflow
- Keep `graph.mmd` readable by preserving indentation generated by the script; avoid manual edits unless patching quickly.
- When expanding the storyline, update node metadata in `scripts/gen-tree-progressive.js` and re-run the script so phases remain in sync.
